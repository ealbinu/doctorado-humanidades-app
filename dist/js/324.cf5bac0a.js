"use strict";(self["webpackChunkiconos_plataforma"]=self["webpackChunkiconos_plataforma"]||[]).push([[324],{4324:(e,a,t)=>{t.r(a),t.d(a,{default:()=>se});var o=t(3673),l=t(2323);const i=(0,o._)("div",{class:"text-caption"},"Periodos",-1),n={class:"text-center q-mb-sm"},s=(0,o.Uk)("Modificar"),r=(0,o.Uk)("Modificar"),d=(0,o.Uk)("Eliminar"),c={class:"text-caption text-center q-mt-md"},m=(0,o.Uk)("Seleccione el periodo actual marcando la casilla a la izquierda"),u=(0,o.Uk)(" para asignar el periodo que transcurre en la plataforma. No podrá eliminar el periodo actual. Para actualizar las fechas de inicio o fin dé clic sobre la fecha.");function p(e,a,t,p,w,D){const g=(0,o.up)("q-icon"),f=(0,o.up)("q-tooltip"),_=(0,o.up)("q-btn"),v=(0,o.up)("q-td"),b=(0,o.up)("q-date"),h=(0,o.up)("q-popup-proxy"),Y=(0,o.up)("q-tr"),k=(0,o.up)("q-table"),y=(0,o.up)("q-card-section"),P=(0,o.up)("q-card"),Z=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(Z,{padding:""},{default:(0,o.w5)((()=>[(0,o.Wm)(P,{class:"shadow-24"},{default:(0,o.w5)((()=>[(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(k,{class:"shadow-0",loading:p.loading,"no-data-label":"Sin datos",rows:p.items,columns:p.columns,pagination:p.pagination},{top:(0,o.w5)((()=>[i,(0,o.Wm)(p["NuevoSetDePeriodoVue"],{onUpdated:p.updatePeriodos})])),body:(0,o.w5)((e=>[(0,o.Wm)(Y,{props:e,class:(0,l.C_)(e.row.actual?"bg-blue-grey-1 text-primary":"")},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{key:"actual",props:e},{default:(0,o.w5)((()=>[e.row.actual?((0,o.wg)(),(0,o.j4)(g,{key:0,name:"check",color:"primary",size:"md"})):((0,o.wg)(),(0,o.j4)(_,{key:1,icon:"check_box_outline_blank",unelevated:"",color:"primary",flat:"",size:"sm",onClick:a=>p.setPeriodo(e.row)},{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Asignar "+(0,l.zw)(e.row.name)+" como periodo actual.",1)])),_:2},1024)])),_:2},1032,["onClick"]))])),_:2},1032,["props"]),(0,o.Wm)(v,{class:"text-bold text-body1",key:"name",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.row.name),1)])),_:2},1032,["props"]),(0,o.Wm)(v,{class:"text-bold",key:"asignaciones",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.row.asignaciones.length),1)])),_:2},1032,["props"]),(0,o.Wm)(v,{key:"startDate",props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{flat:"",label:e.row.startDate},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{cover:"","transition-show":"scale",onShow:a=>p.modStartDate(e.row)},{default:(0,o.w5)((()=>[(0,o._)("div",null,[(0,o._)("div",null,[(0,o.Wm)(b,{modelValue:p.editingDate,"onUpdate:modelValue":a[0]||(a[0]=e=>p.editingDate=e),minimal:"",flat:"","no-unset":""},null,8,["modelValue"])]),(0,o._)("div",n,[(0,o.Wm)(_,{label:"Modificar",color:"primary",size:"sm"})])])])),_:2},1032,["onShow"]),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[s])),_:1})])),_:2},1032,["label"])])),_:2},1032,["props"]),(0,o.Wm)(v,{key:"endDate",props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{flat:"",label:e.row.endDate,onClick:a=>p.modEndDate(e.row)},{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[r])),_:1})])),_:2},1032,["label","onClick"])])),_:2},1032,["props"]),(0,o.Wm)(v,{key:"actions",props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{icon:"delete",onClick:a=>p.deleteItem(e.row),size:"xs",color:"negative",round:"",unelevated:"",disabled:e.row.actual},{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[d])),_:1})])),_:2},1032,["onClick","disabled"])])),_:2},1032,["props"])])),_:2},1032,["props","class"])])),bottom:(0,o.w5)((()=>[(0,o._)("div",c,[m,(0,o.Wm)(g,{name:"check"}),u])])),_:1},8,["loading","rows"])])),_:1})])),_:1})])),_:1})}var w=t(1959),D=t(9582),g=t(3617),f=t(885),_=t(5616),v=t(8825),b=t(8880);const h={class:"row q-col-gutter-md items-center"},Y={class:"col-12"},k={class:"row q-col-gutter-md items-center text-center q-mt-xs"},y={key:0,class:"col-sm-2 col-12"},P={class:"bg-white rounded-borders q-py-xs text-h6"},Z={key:0},q=(0,o.Uk)("-"),x={class:"col-sm-4 col-5"},W={class:"col-sm-4 col-5"},M={class:"col text-center"},S=(0,o.Uk)("Eliminar fecha"),U=(0,o.Uk)("Nueva fecha"),V={class:"row q-col-gutter-md items-center q-mt-xs"},Q={class:"col-12 text-center"},C={class:"q-mt-md text-center text-caption text-white"},I=(0,o.Uk)('Para crear nuevos periodos ingrese el nombre, fechas de inicio y fin. Puede añadir múltiples periodos con nombres consecutivos dándo click en "'),N=(0,o.Uk)(' Nueva Fecha"');function z(e,a,t,i,n,s){const r=(0,o.up)("q-input"),d=(0,o.up)("q-separator"),c=(0,o.up)("q-date"),m=(0,o.up)("q-popup-proxy"),u=(0,o.up)("q-tooltip"),p=(0,o.up)("q-btn"),w=(0,o.up)("q-form"),D=(0,o.up)("q-icon"),g=(0,o.up)("q-card-section"),f=(0,o.up)("q-card");return(0,o.wg)(),(0,o.j4)(f,{class:"shadow-24 bg-dark full-width q-my-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w,{onSubmit:(0,b.iM)(i.submitNew,["prevent"])},{default:(0,o.w5)((()=>[(0,o._)("div",h,[(0,o._)("div",Y,[(0,o.Wm)(r,{modelValue:i.periodoName,"onUpdate:modelValue":a[0]||(a[0]=e=>i.periodoName=e),label:"Nombre o año de periodo",standout:"bg-primary text-white text-h6","input-class":"text-center text-white",dense:"",dark:"",required:""},null,8,["modelValue"])])]),i.periodoName?((0,o.wg)(!0),(0,o.iD)(o.HY,{key:0},(0,o.Ko)(i.periodos,((e,a)=>((0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(d),(0,o._)("div",k,[i.periodos.length>1?((0,o.wg)(),(0,o.iD)("div",y,[(0,o._)("div",P,[(0,o._)("span",null,(0,l.zw)(i.periodoName),1),i.periodos.length>1?((0,o.wg)(),(0,o.iD)("span",Z,[q,(0,o._)("strong",null,(0,l.zw)(a+1),1)])):(0,o.kq)("",!0)])])):(0,o.kq)("",!0),(0,o._)("div",x,[(0,o.Wm)(r,{class:"cursor-pointer",modelValue:e.startDate,"onUpdate:modelValue":a=>e.startDate=a,label:"Inicio",standout:"bg-primary text-white",dense:"",dark:"",readonly:""},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{cover:"","transition-show":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{modelValue:e.startDate,"onUpdate:modelValue":a=>e.startDate=a,minimal:"",mask:"YYYY-MM-DD","no-unset":""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue"])]),(0,o._)("div",W,[(0,o.Wm)(r,{class:"cursor-pointer",modelValue:e.endDate,"onUpdate:modelValue":a=>e.endDate=a,label:"Fin",type:"date",standout:"bg-primary text-white",dense:"",dark:"",readonly:""},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{cover:"","transition-show":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{modelValue:e.endDate,"onUpdate:modelValue":a=>e.endDate=a,minimal:"",mask:"YYYY-MM-DD","navigation-min-year-month":i.date.formatDate(e.startDate,"YYYY/MM"),"no-unset":""},null,8,["modelValue","onUpdate:modelValue","navigation-min-year-month"])])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue"])]),(0,o._)("div",M,[a>0?((0,o.wg)(),(0,o.j4)(p,{key:0,class:"q-mx-auto",color:"grey",size:"xs",padding:"2px 6px",icon:"remove",onClick:e=>i.deletePeriodo(a)},{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[S])),_:1})])),_:2},1032,["onClick"])):(0,o.kq)("",!0),i.periodos.length-1==a?((0,o.wg)(),(0,o.j4)(p,{key:1,class:"q-mt-sm",color:"primary",size:"sm",icon:"add",onClick:i.newPeriodo},{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[U])),_:1})])),_:1})):(0,o.kq)("",!0)])])],64)))),256)):(0,o.kq)("",!0),(0,o._)("div",V,[(0,o._)("div",Q,[(0,o.Wm)(p,{label:i.periodos.length>1?"Crear set de periodos":"Crear periodo",color:"primary",unelevated:"","no-caps":"",type:"submit"},null,8,["label"])])])])),_:1},8,["onSubmit"]),(0,o._)("div",C,[I,(0,o.Wm)(D,{name:"add"}),N])])),_:1})])),_:1})}const j={props:{},emits:["updated"],setup(e,{expose:a,emit:t}){a();const o=e,l=(0,g.oR)(),i=Date.now(),n=(0,w.iH)(_.ZP.formatDate(i,"YYYY")),s=[{startDate:_.ZP.formatDate(i,"YYYY-MM-DD"),endDate:_.ZP.formatDate(_.ZP.addToDate(i,{days:1}),"YYYY-MM-DD")}],r=(0,w.iH)();r.value=s;const d=()=>{const e=new Date(r.value[r.value.length-1].endDate),a={startDate:_.ZP.formatDate(_.ZP.addToDate(e,{days:2}),"YYYY-MM-DD"),endDate:_.ZP.formatDate(_.ZP.addToDate(e,{days:3}),"YYYY-MM-DD")};console.log(a),r.value.push(a)},c=e=>{r.value.splice(e,1)},m=()=>{for(var e in r.value){const a={...r.value[e],coll:"periodos"};a.name=n.value,r.value.length>1&&(a.name+="-"+(1*e+1)),l.dispatch("api/SaveItem",a).then((e=>{r.value=s,n.value=_.ZP.formatDate(i,"YYYY"),t("updated")}))}},u={$store:l,props:o,emit:t,todayDate:i,periodoName:n,periodosInit:s,periodos:r,newPeriodo:d,deletePeriodo:c,submitNew:m,useStore:g.oR,date:_.ZP,useQuasar:v.Z,ref:w.iH};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}};var H=t(4260),E=t(151),R=t(5589),T=t(5269),F=t(4842),A=t(5869),$=t(3944),B=t(1860),O=t(8240),G=t(8870),K=t(4554),L=t(7518),J=t.n(L);const X=(0,H.Z)(j,[["render",z]]),ee=X;J()(j,"components",{QCard:E.Z,QCardSection:R.Z,QForm:T.Z,QInput:F.Z,QSeparator:A.Z,QPopupProxy:$.Z,QDate:B.Z,QBtn:O.Z,QTooltip:G.Z,QIcon:K.Z});const ae={setup(e,{expose:a}){a();const t=(0,v.Z)(),l=(0,D.yj)(),i=(0,g.oR)(),n=(0,w.Fl)((()=>i.getters["api/getPeriodo"])),s=()=>{k()},r=(0,w.iH)(!0),d=(0,w.iH)(),c=e=>{d.value=_.ZP.formatDate(new Date(e.startDate),"YYYY/MM/DD")},m=e=>{},u=(0,w.iH)([]),p={sortBy:"startDate",descending:!0,rowsPerPage:10},b=[{name:"actual",label:"Actual",field:"actual",align:"center"},{name:"name",label:"Nombre",field:"name",align:"left"},{name:"asignaciones",label:"Estudiantes inscritos",field:"asignaciones",align:"center"},{name:"startDate",label:"Inicio",field:"startDate",align:"center",sortable:!0},{name:"endDate",label:"Fin",field:"endDate",align:"center",sortable:!0},{name:"actions"}],h=(0,w.iH)({name:"",startDate:_.ZP.formatDate(Date.now(),"YYYY-MM-DD"),endDate:_.ZP.formatDate(Date.now(),"YYYY-MM-DD")}),Y=()=>{const e={...h.value,coll:"periodos"};i.dispatch("api/SaveItem",e).then((e=>{k(),h.value={name:"",startDate:_.ZP.formatDate(Date.now(),"YYYY-MM-DD"),endDate:_.ZP.formatDate(Date.now(),"YYYY-MM-DD")}}))},k=()=>{u.value=[],i.dispatch("api/GetAllData","periodos").then((e=>{u.value=e,r.value=!1})),i.dispatch("api/GetPeriodo")};k();const y=e=>{let a="";e.asignaciones.length>0&&(a="Se eliminarán las asignaciones de estudiantes inscritos. Los reportes de los asesores también serán eliminados."),1==e.asignaciones.length?a+="<br><br> <strong>Se eliminará "+e.asignaciones.length+" asignacion de estudiante inscrito al periodo.</strong>":e.asignaciones.length>1&&(a+="<br><br> <strong>Se eliminarán "+e.asignaciones.length+" asignaciones de estudiantes inscritos al periodo.</strong>"),t.dialog({title:"Eliminar periodo",message:a,html:!0,cancel:"Cancelar",ok:"Eliminar"}).onOk((()=>{q(e)}))};let P=0,Z=0;const q=async e=>{i.dispatch("api/RemoveItem",["periodos","_id",e._id]);for(var a in e.asignaciones){const t=e.asignaciones[a],n=t._id;await i.dispatch("api/RemoveItem",["asignaciones","_id",n]);for(var o in P++,t.asesores_directores){const e=t.asesores_directores[o]._id;Z++;await i.dispatch("api/RemoveItem",["asesores","_id",e])}for(var l in t.asesores_lectores){const e=t.asesores_lectores[l]._id;Z++;await i.dispatch("api/RemoveItem",["asesores","_id",e])}}0==P&&0==Z?t.notify("Se eliminó el periodo."):t.notify("Se eliminó el periodo con "+P+" asignaciones y "+Z+" reportes de asesores."),k()},x=e=>{console.log(e),i.dispatch("api/SetPeriodo",e).then((e=>{k(),t.notify("Periodo actual modificado")}))},W={$q:t,$route:l,$store:i,periodoActual:n,updatePeriodos:s,loading:r,editingDate:d,modStartDate:c,modEndDate:m,items:u,pagination:p,columns:b,newItem:h,submitNew:Y,loadItem:k,deleteItem:y,asesoriasEliminadas:P,asesoresEliminados:Z,deletePeriodo:q,setPeriodo:x,ref:w.iH,computed:w.Fl,watch:o.YP,useRoute:D.yj,useStore:g.oR,editThis:f.Z,date:_.ZP,useQuasar:v.Z,NuevoSetDePeriodoVue:ee};return Object.defineProperty(W,"__isScriptSetup",{enumerable:!1,value:!0}),W}};var te=t(4379),oe=t(3243),le=t(8186),ie=t(3884);const ne=(0,H.Z)(ae,[["render",p]]),se=ne;J()(ae,"components",{QPage:te.Z,QCard:E.Z,QCardSection:R.Z,QTable:oe.Z,QTr:le.Z,QTd:ie.Z,QIcon:K.Z,QBtn:O.Z,QTooltip:G.Z,QPopupProxy:$.Z,QDate:B.Z})}}]);